<!DOCTYPE html>
<html layout:decorate="~{/layout.html}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>CHATTING</title>
</head>

<body>
<div layout:fragment="content">
<div class="container-fluid position-relative d-flex p-0">
    <!-- Content Start -->
    <div class="content">
        <!-- Chat Box Start -->
        <div class="container-fluid pt-4 px-4">
            <div class="row vh-100 bg-secondary rounded align-items-center justify-content-center mx-0">
                <div class="col-md-6">
                    <div class="bg-dark text-white p-4 rounded">
                        <div class="chat-window border-bottom pb-3 mb-3" id="chat-window"
                             style="height: 300px; overflow-y: auto;">
                            <!-- 대화 내용이 여기 표시됩니다 -->
                        </div>
                        <div class="input-group">
                            <input aria-describedby="button-send" aria-label="Message" class="form-control" id="message"
                                   placeholder="메시지를 입력하세요..." type="text">
                            <button class="btn btn-primary" id="send" type="button">보내기</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Chat Box End -->


        <!-- Footer Start -->
        <div class="container-fluid pt-4 px-4">
            <div class="bg-secondary rounded-top p-4">
                <div class="row">
                    <div class="col-12 col-sm-6 text-center text-sm-start">
                        &copy; <a href="#">Your Site Name</a>, All Right Reserved.
                    </div>
                    <div class="col-12 col-sm-6 text-center text-sm-end">
                        <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                        Designed By <a href="https://htmlcodex.com">HTML Codex</a>
                        <br>Distributed By: <a href="https://themewagon.com" target="_blank">ThemeWagon</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->
    </div>
    </div>
    <!-- Content End -->

    <!-- Back to Top -->
    <a class="btn btn-lg btn-primary btn-lg-square back-to-top" href="#"><i class="bi bi-arrow-up"></i></a>
</div>
<script>
    document.getElementById('send').addEventListener('click', function () {
        const messageInput = document.getElementById('message');
        const message = messageInput.value;

        if (message.trim() !== "") {
            // 메시지를 서버로 전송
            fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'message=' + encodeURIComponent(message)
            })
                .then(response => response.text())
                .then(data => {
                    // 서버에서 받은 응답을 대화창에 표시
                    const chatWindow = document.getElementById('chat-window');
                    chatWindow.innerHTML += `<div class="text-end text-white"><p class="bg-primary p-2 rounded">${message}</p></div>`;
                    chatWindow.innerHTML += `<div class="text-start text-white"><p class="bg-secondary p-2 rounded">${data}</p></div>`;
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                    messageInput.value = '';
                });
        }
    });
</script>
</body>
</html>